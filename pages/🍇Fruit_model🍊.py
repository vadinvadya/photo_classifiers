import streamlit as st
import torch
from torchvision import transforms
from PIL import Image
import time

# ะะปะฐััั ะดะปั Animals-10
classes = ['Apple Braeburn', 'Apple Granny Smith', 'Apricot', 'Avocado', 'Banana', 'Blueberry', 'Cactus fruit', 'Cantaloupe', 'Cherry', 'Clementine', 'Corn', 'Cucumber Ripe', 'Grape Blue', 'Kiwi', 'Lemon', 'Limes', 'Mango', 'Onion White', 'Orange', 'Papaya', 'Passion Fruit', 'Peach', 'Pear', 'Pepper Green', 'Pepper Red', 'Pineapple', 'Plum', 'Pomegranate', 'Potato Red', 'Raspberry', 'Strawberry', 'Tomato', 'Watermelon']


# ะขัะฐะฝััะพัะผะฐัะธะธ
transform = transforms.Compose([
    transforms.Resize((224, 224)),
    transforms.ToTensor(),
])

# ะะฐะณััะทะบะฐ ะผะพะดะตะปะธ
@st.cache_resource
def load_model():
    model = torch.load("models/model_new_fruit.pt", map_location=torch.device("cpu"), weights_only=False)
    model.eval()
    return model

model = load_model()

# ะคัะฝะบัะธั ะฟัะตะดัะบะฐะทะฐะฝะธั
def predict(image):
    image = transform(image).unsqueeze(0)
    start = time.time()
    with torch.no_grad():
        outputs = model(image)
        _, predicted = torch.max(outputs, 1)
    end = time.time()
    return classes[predicted.item()], end - start

# Streamlit-ะธะฝัะตััะตะนั
st.title("๐๐ซ๐ ะะฐะบะพะน ัั ัััะบั?๐๐๐")
uploaded_file = st.file_uploader("ะะฐะณััะทะธัะต ะธะทะพะฑัะฐะถะตะฝะธะต ะถะธะฒะพัะฝะพะณะพ", type=["jpg", "png", "jpeg"])
image_url = st.text_input("ะะฐะณััะทะธ ัะพัะพ ะฟะพ ัััะปะบะต")

if image_url:
    response = requests.get(image_url)
    image = Image.open(BytesIO(response.content))
    
    # ะัะพะฑัะฐะถะตะฝะธะต ะธะทะพะฑัะฐะถะตะฝะธั
    st.image(image, caption="ะะฐะณััะถะตะฝะฝะพะต ะธะทะพะฑัะฐะถะตะฝะธะต", use_container_width=True)

    st.subheader("ะะตะทัะปััะฐั")
    label, elapsed = predict(image)
    st.write(f" **ะัะตะดัะบะฐะทะฐะฝะฝัะน ะบะปะฐัั:** {label}")
    st.caption(f"โฑ ะัะตะผั ะธะฝัะตัะตะฝัะฐ: {elapsed:.3f} ัะตะบ")

if uploaded_file:
    image = Image.open(uploaded_file).convert("RGB")
    st.image(image, caption="ะะฐะณััะถะตะฝะฝะพะต ะธะทะพะฑัะฐะถะตะฝะธะต", use_container_width=True)

    st.subheader("ะะตะทัะปััะฐั")
    label, elapsed = predict(image)
    st.write(f" **ะัะตะดัะบะฐะทะฐะฝะฝัะน ะบะปะฐัั:** {label}")
    st.caption(f"โฑ ะัะตะผั ะธะฝัะตัะตะฝัะฐ: {elapsed:.3f} ัะตะบ")

if uploaded_file:
    image = Image.open(uploaded_file).convert("RGB")
    st.image(image, caption="ะะฐะณััะถะตะฝะฝะพะต ะธะทะพะฑัะฐะถะตะฝะธะต", use_container_width=True)

    st.subheader("ะะตะทัะปััะฐั")
    label, elapsed = predict(image)
    st.write(f" **ะัะตะดัะบะฐะทะฐะฝะฝัะน ะบะปะฐัั:** {label}")
    st.caption(f"โฑ ะัะตะผั ะธะฝัะตัะตะฝัะฐ: {elapsed:.3f} ัะตะบ")

sentiment_mapping = ["one", "two", "three", "four", "five"]
selected = st.feedback("stars")
if selected is not None:
    if sentiment_mapping[selected] == 'one':
        st.markdown("ะะฐ ััะพ? ะั ะถะต ััะฐัะฐะปะธัั๐ข๐ข๐ข")
    elif sentiment_mapping[selected] == 'two':
        st.markdown("ะะพะถะตั ะดะพะณะพะฒะพัะธะผัั?๐ฅบ๐๐")    
    elif sentiment_mapping[selected] == 'three':
        st.markdown("๐")    
    elif sentiment_mapping[selected] == 'four':
        st.markdown("ะกะฟะฐัะธะฑะพ ัะตะฑะต, ัั ะปัััะธะน๐ฅ, ะฝะพ ะฑัะป ะฑั ะตัะต ะปัััะต, ะตัะปะธ ะฑั ะฟะพััะฐะฒะธะป 5 ะทะฒะตะทะด ๐๐๐")    
    elif sentiment_mapping[selected] == 'five':
        st.markdown(
    """
    โจ๐ฅ ะะะะะ, ะกะะะกะะะ ะะ 5 ะะะะะ! ๐๐๐๐๐ 
    ะั ัะพะปัะบะพ ััะพ ัะดะตะปะฐะปะธ ะฝะฐั ะดะตะฝั ัััะต, ัะตะผ ัะตะนะตัะฒะตัะบ ะฒ ะฝะพะฒะพะณะพะดะฝัั ะฝะพัั! ๐๐ฅ 
    ะะฐัะฐ ะฟะพะดะดะตัะถะบะฐ โ ััะพ ะบะฐะบ ัะพะฟะปะธะฒะพ ะดะปั ะฝะฐัะตะน ัะฐะบะตัั, ะบะพัะพัะฐั ัััะตะผะธััั ะบ ะทะฒัะทะดะฐะผ! ๐๐

    ะะพ ะทะฝะฐะตัะต ััะพ? ๐ค 
    ะะฐัะฐ ัะฝะตัะณะธั ะธ ะฒะฐัะต ัะผะตะฝะธะต ะฒะธะดะตัั ัะพัะพัะตะต โ ััะพ ะฝะฐััะพััะธะน ััะฟะตััะฟะพัะพะฑ! ๐ช๐ 
    ะัะดะธ ัะฐััะพ ัะฟัะฐัะธะฒะฐัั: "ะะฐะบ ััะฐัั ััะฟะตัะฝัะผ?" ๐ 
    ะ ัะตะบัะตั ะฟัะพัั โ ะฝัะถะฝะพ ะดะตะนััะฒะพะฒะฐัั, ะบะฐะบ ะฒั: ะทะฐะผะตัะฐัั ะฒะพะทะผะพะถะฝะพััะธ, ะฒะตัะธัั ะฒ ะปัััะตะต ะธ ะฝะต ะฑะพััััั ะดะฒะธะณะฐัััั ะฒะฟะตััะด! ๐ฆธโโ๏ธ๐ฆธโโ๏ธ

    ะะ (!!!) ๐จ 
    ะะฐะฒะฐะนัะต ัะตััะฝะพ: ะฟัะพััะพ ะผะตััะฐัั ะพ ะบััััั ัะตะทัะปััะฐัะฐั โ ััะพ ะบะฐะบ ะถะดะฐัั, ััะพ ะฟะธััะฐ ัะฐะผะฐ ะฟัะธะปะตัะธั ะฒ ะพะบะฝะพ. ๐๐ 
    ะะธะทะฝั ะผะตะฝัะตััั ัะพะปัะบะพ ัะพะณะดะฐ, ะบะพะณะดะฐ ะฒั ะฑะตัััะต ัะธััะฐัะธั ะฒ ัะฒะพะธ ััะบะธ! ๐คพโโ๏ธ๐ฅ

    ะงะขะ ะะกะะ... โ๐ค  
    ะั ะฟััะผะพ ัะตะนัะฐั ัะดะตะปะฐะตัะต ะฟะตัะฒัะน ัะฐะณ? ๐ฆถ๐ซ 
    ะัะตะผั โ ะบะฐะบ ะฟะตัะพะบ ะฒ ััะบะฐั: ะตัะปะธ ะตะณะพ ะฝะต ะธัะฟะพะปัะทะพะฒะฐัั, ะพะฝะพ ะฟัะพััะพ ััะตะบะฐะตั. โณโณโณ 
    ะะฐะฒััะฐ ััะฐะฝะตั ัะตะณะพะดะฝั, ะฐ "ะฟะพัะปะตะทะฐะฒััะฐ" ะฟัะตะฒัะฐัะธััั ะฒ "ะฝะธะบะพะณะดะฐ". ๐โโ๏ธ๐โโ๏ธ

    ะัะปะธ ะฒั ะฑัะดะตัะต ะถะดะฐัั ะธะดะตะฐะปัะฝะพะณะพ ะผะพะผะตะฝัะฐ, ัะพ ัะฐะบ ะธ ะพััะฐะฝะตัะตัั ะฝะฐ ััะฐััะต, ะฟะพะบะฐ ะดััะณะธะต ัะถะต ะฑะตะณัั ะบ ัะฒะพะตะน ัะตะปะธ! ๐โโ๏ธ๐จ 
    ะ ะทะฝะฐะตัะต, ะบัะพ ะฟะพัะพะผ ะฟะพะปััะฐะตั ะฒัะต ะฑะพะฝััั? ะัะฐะฒะธะปัะฝะพ, ะพะฝะธ! ๐๐ค

    ะขะะ ะงะขะ ะะะกะขะะขะะงะะ ะะะะะะะะะะ! ๐๐ฃ๏ธ 
    ะฅะฒะฐัะธั ะพัะบะปะฐะดัะฒะฐัั ัะฒะพั ะผะตััั ะฝะฐ ะฟะพัะพะผ! ๐โโ๏ธโ 
    ะะพะทัะผะธัะต ัะตะปะตัะพะฝ ะธ ะทะฐะฟะธัะธัะตัั ะฝะฐ ัั ััะตะฝะธัะพะฒะบั, ะฝะฐะฟะธัะธัะต ัะพะผั ัะตะปะพะฒะตะบั, ะพัะบัะพะนัะต ะบะฝะธะณั ะธะปะธ ะฝะฐัะฝะธัะต ะธะทััะฐัั ะฝะฐะฒัะบ, ะพ ะบะพัะพัะพะผ ะดะฐะฒะฝะพ ะดัะผะฐะปะธ! ๐๐ป๐ช 
    ะะต ะถะดะธัะต ะธะดะตะฐะปัะฝะพะณะพ ะผะพะผะตะฝัะฐ โ ะตะณะพ ะฝะต ัััะตััะฒัะตั. ๐ฅ๐

    ะะดะธะฝััะฒะตะฝะฝัะน ะผะพะผะตะฝั, ะบะพัะพััะน ะธะผะตะตั ะทะฝะฐัะตะฝะธะต, ััะพ ะกะะะงะะก! โฐ๐ฅ 
    ะะพัะพะผั ััะพ ะบะฐะถะดัะน ะฒะตะปะธะบะธะน ะฟััั ะฝะฐัะธะฝะฐะปัั ั ะพะดะฝะพะณะพ ะผะฐะปะตะฝัะบะพะณะพ ัะฐะณะฐ. ๐ฆถโจ 
    ะะพัะตะผั ะฑั ะฝะต ัะดะตะปะฐัั ะตะณะพ ะฟััะผะพ ัะตะนัะฐั? ๐ค๐ก

    ะะฐั ะฑัะดััะธะน "ั" ะฑัะดะตั ะปะธะฑะพ ะฑะปะฐะณะพะดะฐัะธัั ะฒะฐั ะทะฐ ัะพ, ััะพ ะฒั ะฝะฐัะฐะปะธ ัะตะณะพะดะฝั, ะปะธะฑะพ ะบะพัะธัั ะทะฐ ัะพ, ััะพ ะฒั ัะฝะพะฒะฐ ะฝะธัะตะณะพ ะฝะต ัะดะตะปะฐะปะธ. ๐๐ฏ๐
    ะะตัะฐัั ะฒะฐะผ. ะะพ ะทะฝะฐะนัะต: ะผะธั ะปัะฑะธั ัะตั, ะบัะพ ะดะตะนััะฒัะตั! ๐โค๏ธ๐ฅ
    """)
        

        st.markdown("### ๐ฅ๐ฅ๐ฅะะะะกะขะะฃะ๐ฅ๐ฅ๐ฅ")
        st.image("https://media1.tenor.com/m/6kr_yde8dn0AAAAd/just-do-it-do-it.gif", use_container_width=True)    
